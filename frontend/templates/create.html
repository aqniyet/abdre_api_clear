{% extends "layouts/app.html" %}

{% block page_title %}Create Chat{% endblock %}

{% block body_class %}layout-app page-app page-create-chat{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/create.css') }}">
{% endblock %}

{% block header_title %}
    <h1 class="header-title">Create Chat</h1>
{% endblock %}

{% block app_content %}
    <div class="create-chat-container">
        <div class="chat-type-selector">
            <div class="selector-tabs">
                <button type="button" class="selector-tab active" data-type="direct">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z" fill="currentColor"/>
                    </svg>
                    Direct Chat
                </button>
                <button type="button" class="selector-tab" data-type="group">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 11C17.66 11 18.99 9.66 18.99 8C18.99 6.34 17.66 5 16 5C14.34 5 13 6.34 13 8C13 9.66 14.34 11 16 11ZM8 11C9.66 11 10.99 9.66 10.99 8C10.99 6.34 9.66 5 8 5C6.34 5 5 6.34 5 8C5 9.66 6.34 11 8 11ZM8 13C5.67 13 1 14.17 1 16.5V19H15V16.5C15 14.17 10.33 13 8 13ZM16 13C15.71 13 15.38 13.02 15.03 13.05C16.19 13.89 17 15.02 17 16.5V19H23V16.5C23 14.17 18.33 13 16 13Z" fill="currentColor"/>
                    </svg>
                    Group Chat
                </button>
            </div>
        </div>
        
        <div class="create-direct-chat" id="direct-chat-form">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="search-icon">
                        <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
                    </svg>
                    <input type="text" id="user-search" class="search-input" placeholder="Search for a user...">
                    <button type="button" id="clear-search" class="clear-search-btn" style="display: none;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="search-results" id="search-results">
                <div class="search-status">
                    <p>Search for users to start a chat</p>
                </div>
            </div>
            
            <div class="selected-users" id="selected-users"></div>
            
            <div class="form-actions">
                <button type="button" id="create-direct-btn" class="btn btn-primary btn-block" disabled>Start Chat</button>
            </div>
        </div>
        
        <div class="create-group-chat" id="group-chat-form" style="display: none;">
            <div class="form-group">
                <label for="group-name">Group Name</label>
                <input type="text" id="group-name" class="form-control" placeholder="Enter a name for your group">
            </div>
            
            <div class="form-group">
                <label for="group-description">Description (Optional)</label>
                <textarea id="group-description" class="form-control" placeholder="Describe the purpose of this group" rows="3"></textarea>
            </div>
            
            <div class="form-group">
                <label>Group Members</label>
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="search-icon">
                            <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="currentColor"/>
                        </svg>
                        <input type="text" id="group-user-search" class="search-input" placeholder="Add people to the group...">
                        <button type="button" id="group-clear-search" class="clear-search-btn" style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="group-search-results" id="group-search-results">
                    <div class="search-status">
                        <p>Search for users to add to the group</p>
                    </div>
                </div>
                
                <div class="group-members" id="group-members">
                    <div class="group-member current-user">
                        <div class="member-avatar">
                            {% if user and user.avatar_url %}
                            <img src="{{ user.avatar_url }}" alt="{{ user.display_name or user.username }}">
                            {% else %}
                            <div class="avatar-placeholder">{% if user %}{{ user.display_name[0:1] if user.display_name else user.username[0:1] if user.username else 'U' }}{% else %}U{% endif %}</div>
                            {% endif %}
                        </div>
                        <div class="member-info">
                            <div class="member-name">{% if user %}{{ user.display_name or user.username }}{% else %}User{% endif %} (You)</div>
                            <div class="member-role">Group Admin</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" id="create-group-btn" class="btn btn-primary btn-block" disabled>Create Group</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block app_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize modules
            ABDRE.EventBus.init();
            ABDRE.RealtimeService.init({
                host: window.location.hostname + ':5000',
                path: '/socket.io',
                authToken: 'guest'
            }).connect();
            ABDRE.Enhancers.ConnectionStatus.init();
            ABDRE.Enhancers.CreateChat.init();
        });
    </script>
{% endblock %}

{% block extra_js %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/services/api_service.js') }}"></script>
    <script src="{{ url_for('static', filename='js/services/chat_service.js') }}"></script>
    <script src="{{ url_for('static', filename='js/enhancers/create_chat_enhancer.js') }}"></script>
{% endblock %} 