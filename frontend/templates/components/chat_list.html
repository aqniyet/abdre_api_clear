<div class="chat-list-container">
  <div class="chat-list-header">
    <h2 class="chat-list-title">My Chats</h2>
    <div class="chat-list-actions">
      <a href="{{ url_for('render_new_chat') }}" class="btn btn-primary btn-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
        </svg>
        New Chat
      </a>
    </div>
  </div>
  
  <div class="chat-list-search">
    <svg class="chat-list-search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <input type="search" class="chat-list-search-input" placeholder="Search chats..." id="chatSearchInput">
  </div>
  
  <div class="chat-list-filter">
    <button type="button" class="filter-btn active" data-filter="all">All</button>
    <button type="button" class="filter-btn" data-filter="recent">Recent</button>
    <button type="button" class="filter-btn" data-filter="unread">Unread</button>
    <button type="button" class="filter-btn" data-filter="important">Important</button>
  </div>
  
  {% if chats and chats|length > 0 %}
  <ul class="chat-list" id="chatList">
    {% for chat in chats %}
    <li class="chat-item {% if chat.unread %}unread{% endif %} {% if chat.id == current_chat_id %}active{% endif %}">
      <a href="{{ url_for('render_chat', chat_id=chat.id) }}" class="chat-item-link">
        <div class="chat-item-avatar">
          {% if chat.image_url %}
            <img src="{{ chat.image_url }}" alt="{{ chat.title }}">
          {% else %}
            {{ chat.title[0:1] }}
          {% endif %}
          {% if chat.is_online %}
          <span class="online-indicator"></span>
          {% endif %}
        </div>
        <div class="chat-item-content">
          <div class="chat-item-header">
            <h3 class="chat-item-title">{{ chat.title }}</h3>
            <span class="chat-item-time">{{ chat.last_message_time|timeago }}</span>
          </div>
          <p class="chat-item-preview">
            {% if chat.last_message %}
              {{ chat.last_message|truncate(60) }}
            {% else %}
              No messages yet
            {% endif %}
          </p>
          <div class="chat-item-footer">
            <div class="chat-item-meta">
              {% if chat.is_important %}
              <span class="chat-item-label important">Important</span>
              {% endif %}
              {% if chat.unread %}
              <span class="unread-indicator"></span>
              {% endif %}
            </div>
            <div class="chat-item-actions">
              <button type="button" class="chat-action-btn" aria-label="Mark as important">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                </svg>
              </button>
              <button type="button" class="chat-action-btn" aria-label="More options">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </a>
    </li>
    {% endfor %}
  </ul>
  
  {% if chats|length > 10 %}
  <div class="chat-list-pagination">
    <button type="button" class="pagination-btn" id="prevPageBtn" disabled>
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
    </button>
    <button type="button" class="pagination-btn" id="nextPageBtn">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
      </svg>
    </button>
  </div>
  {% endif %}
  
  {% else %}
  <div class="chat-list-empty">
    <div class="chat-list-empty-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
    </div>
    <p class="chat-list-empty-text">You don't have any chats yet. Start a new conversation to get started.</p>
    <a href="{{ url_for('render_new_chat') }}" class="btn btn-primary">
      Start a New Chat
    </a>
  </div>
  {% endif %}
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    const chatList = document.getElementById('chatList');
    const chatItems = chatList ? chatList.querySelectorAll('.chat-item') : [];
    
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Update active button
        filterButtons.forEach(btn => btn.classList.remove('active'));
        this.classList.add('active');
        
        const filter = this.getAttribute('data-filter');
        
        if (!chatItems.length) return;
        
        // Apply filter
        if (filter === 'all') {
          chatItems.forEach(item => item.style.display = '');
        } else if (filter === 'unread') {
          chatItems.forEach(item => {
            item.style.display = item.classList.contains('unread') ? '' : 'none';
          });
        } else if (filter === 'important') {
          chatItems.forEach(item => {
            const hasImportantLabel = item.querySelector('.chat-item-label.important');
            item.style.display = hasImportantLabel ? '' : 'none';
          });
        } else if (filter === 'recent') {
          // Show only the 5 most recent chats
          chatItems.forEach((item, index) => {
            item.style.display = index < 5 ? '' : 'none';
          });
        }
      });
    });
    
    // Search functionality
    const searchInput = document.getElementById('chatSearchInput');
    
    if (searchInput && chatItems.length) {
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (!searchTerm) {
          chatItems.forEach(item => item.style.display = '');
          return;
        }
        
        chatItems.forEach(item => {
          const title = item.querySelector('.chat-item-title').textContent.toLowerCase();
          const preview = item.querySelector('.chat-item-preview').textContent.toLowerCase();
          
          if (title.includes(searchTerm) || preview.includes(searchTerm)) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      });
    }
    
    // Pagination (simple client-side implementation)
    const prevPageBtn = document.getElementById('prevPageBtn');
    const nextPageBtn = document.getElementById('nextPageBtn');
    
    if (prevPageBtn && nextPageBtn && chatItems.length > 10) {
      const itemsPerPage = 10;
      let currentPage = 1;
      const totalPages = Math.ceil(chatItems.length / itemsPerPage);
      
      function showPage(page) {
        const start = (page - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        
        chatItems.forEach((item, index) => {
          item.style.display = (index >= start && index < end) ? '' : 'none';
        });
        
        // Update button states
        prevPageBtn.disabled = page === 1;
        nextPageBtn.disabled = page === totalPages;
      }
      
      prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          showPage(currentPage);
        }
      });
      
      nextPageBtn.addEventListener('click', function() {
        if (currentPage < totalPages) {
          currentPage++;
          showPage(currentPage);
        }
      });
      
      // Initial page setup
      showPage(currentPage);
    }
  });
</script> 