<div class="messages" id="messages">
    {% if is_empty %}
        <div class="chat-start">
            <div class="chat-start-content">
                <div class="chat-start-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2ZM20 16H5.17L4 17.17V4H20V16Z" fill="currentColor"/>
                    </svg>
                </div>
                <h2>Start a conversation</h2>
                <p>Send a message to begin chatting with {{ chat_name }}.</p>
            </div>
        </div>
    {% else %}
        {% if day_separators %}
            {% for day in day_separators %}
            <div class="day-separator" id="day-{{ day.date }}">
                <span class="day-text">{{ day.display }}</span>
            </div>
            {% endfor %}
        {% endif %}
        
        {% for message in messages %}
        <div class="message-wrapper {% if message.is_self %}self{% else %}other{% endif %}" id="message-{{ message.message_id }}" data-timestamp="{{ message.created_at }}">
            <div class="message {% if message.is_self %}message-self{% else %}message-other{% endif %}">
                {% if not message.is_self %}
                <div class="message-sender">
                    <div class="message-avatar">
                        {% if message.sender.avatar_url %}
                        <img src="{{ message.sender.avatar_url }}" alt="{{ message.sender.display_name or message.sender.username }}">
                        {% else %}
                        <div class="avatar-placeholder">{{ (message.sender.display_name or message.sender.username)[0:1] }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="message-text">{{ message.content }}</div>
                    </div>
                    <div class="message-meta">
                        <span class="message-time">{{ message.created_at_formatted }}</span>
                        {% if message.is_self %}
                            {% if message.is_delivered %}
                            <span class="message-status delivered" title="Delivered">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 7L9.5 15.5L6 12L4.5 13.5L9.5 18.5L19.5 8.5L18 7Z" fill="currentColor"/>
                                </svg>
                            </span>
                            {% elif message.is_read %}
                            <span class="message-status read" title="Read">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M18 7L9.5 15.5L6 12L4.5 13.5L9.5 18.5L19.5 8.5L18 7Z" fill="currentColor"/>
                                </svg>
                            </span>
                            {% else %}
                            <span class="message-status sent" title="Sent">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor"/>
                                </svg>
                            </span>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                <div class="message-actions dropdown">
                    <button class="message-actions-toggle dropdown-toggle" aria-label="Message actions" aria-expanded="false">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 8C13.1 8 14 7.1 14 6C14 4.9 13.1 4 12 4C10.9 4 10 4.9 10 6C10 7.1 10.9 8 12 8ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10ZM12 16C10.9 16 10 16.9 10 18C10 19.1 10.9 20 12 20C13.1 20 14 19.1 14 18C14 16.9 13.1 16 12 16Z" fill="currentColor"/>
                        </svg>
                    </button>
                    <div class="dropdown-menu">
                        <ul class="dropdown-list">
                            <li><button class="dropdown-btn copy-message-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM19 5H8C6.9 5 6 5.9 6 7V21C6 22.1 6.9 23 8 23H19C20.1 23 21 22.1 21 21V7C21 5.9 20.1 5 19 5ZM19 21H8V7H19V21Z" fill="currentColor"/>
                                </svg>
                                Copy
                            </button></li>
                            {% if message.is_self %}
                            <li><button class="dropdown-btn edit-message-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M3 17.25V21H6.75L17.81 9.94L14.06 6.19L3 17.25ZM20.71 7.04C21.1 6.65 21.1 6.02 20.71 5.63L18.37 3.29C17.98 2.9 17.35 2.9 16.96 3.29L15.13 5.12L18.88 8.87L20.71 7.04Z" fill="currentColor"/>
                                </svg>
                                Edit
                            </button></li>
                            <li><button class="dropdown-btn delete-message-btn text-danger">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z" fill="currentColor"/>
                                </svg>
                                Delete
                            </button></li>
                            {% else %}
                            <li><button class="dropdown-btn reply-message-btn">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 9V5L3 12L10 19V15C15 15 18.5 16.5 21 20C20 15 17 10 10 9Z" fill="currentColor"/>
                                </svg>
                                Reply
                            </button></li>
                            <li><button class="dropdown-btn report-message-btn text-danger">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M15.73 3H8.27L3 8.27V15.73L8.27 21H15.73L21 15.73V8.27L15.73 3ZM19 14.9L14.9 19H9.1L5 14.9V9.1L9.1 5H14.9L19 9.1V14.9Z" fill="currentColor"/>
                                    <path d="M12 17C12.83 17 13.5 16.33 13.5 15.5C13.5 14.67 12.83 14 12 14C11.17 14 10.5 14.67 10.5 15.5C10.5 16.33 11.17 17 12 17Z" fill="currentColor"/>
                                    <path d="M13 7H11V13H13V7Z" fill="currentColor"/>
                                </svg>
                                Report
                            </button></li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div> 