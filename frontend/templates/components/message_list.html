<!-- Server-side rendered message list component -->
{% macro message_list(message_groups, is_empty=False) %}
<div id="chat-messages" class="chat-messages">
    {% if is_empty %}
    <div class="text-center p-5">
        <div class="text-muted mb-3">
            <i class="fas fa-comments fa-3x"></i>
        </div>
        <p>No messages yet. Start the conversation!</p>
    </div>
    {% else %}
        {% for date, messages in message_groups.items() %}
        <div class="message-date-group">
            <div class="date-separator">
                <span class="date-label">{{ date }}</span>
            </div>
            
            {% for message in messages %}
            <div class="message-wrapper" 
                 id="message-{{ message.message_id }}" 
                 data-message-id="{{ message.message_id }}"
                 data-timestamp="{{ message.created_at }}">
                
                <div class="message {% if message.is_own %}message-sent status-{{ message.status }}{% else %}message-received{% endif %}">
                    <div class="message-content">{{ message.content_formatted|safe }}</div>
                    <div class="message-time">{{ message.time }}</div>
                    
                    {% if message.is_own %}
                    <div class="message-status">
                        {% if message.status == 'sending' %}
                            <i class="fas fa-clock"></i>
                        {% elif message.status == 'sent' %}
                            <i class="fas fa-check"></i>
                        {% elif message.status == 'delivered' %}
                            <i class="fas fa-check-double"></i>
                        {% elif message.status == 'read' %}
                            <i class="fas fa-check-double" style="color: #0d6efd;"></i>
                        {% elif message.status == 'failed' %}
                            <i class="fas fa-exclamation-triangle"></i>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    {% endif %}
    
    <div id="connection-message" class="alert alert-info text-center visually-hidden">
        Connected to chat server.
    </div>
</div>
{% endmacro %}

<!-- Server-side rendered message group component -->
{% macro message_group(date, messages) %}
<div class="message-date-group">
    <div class="date-separator">
        <span class="date-label">{{ date }}</span>
    </div>
    
    {% for message in messages %}
    <div class="message-wrapper" 
         id="message-{{ message.message_id }}" 
         data-message-id="{{ message.message_id }}"
         data-timestamp="{{ message.created_at }}">
        
        <div class="message {{ message.css_class }} {{ message.status_class if message.is_own else '' }}">
            <div class="message-content">{{ message.content_formatted | safe }}</div>
            <div class="message-time">{{ message.time_formatted }}</div>
            
            {% if message.is_own %}
            <div class="message-status">
                {{ message.status_icon | safe }}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

<!-- Server-side rendered single message component -->
{% macro message(message) %}
<div class="message-wrapper" 
     id="message-{{ message.message_id }}" 
     data-message-id="{{ message.message_id }}"
     data-timestamp="{{ message.created_at }}">
    
    <div class="message {{ message.css_class }} {{ message.status_class if message.is_own else '' }}">
        <div class="message-content">{{ message.content_formatted | safe }}</div>
        <div class="message-time">{{ message.time_formatted }}</div>
        
        {% if message.is_own %}
        <div class="message-status">
            {{ message.status_icon | safe }}
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %} 